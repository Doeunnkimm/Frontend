# 프론트엔드에서의 테스트

## 🤔 테스트 그거 왜 하는건데?

> 발생 가능한 결함을 예방하고 애플리케이션이 요구사항을 충족시키는지 확인하기 위해

- 개발 과정에서 생기는 변경 사항들로 인해 새로운 결함이 유입되지 않았는지 확인 가능
- 개발자는 애플리케이션 품질 수준에 대한 확신이 가능

## 🗺️ 테스트의 유형

- 정적(Static) 테스트
- 단위(Unit) 테스트
- 통합(Integration) 테스트
- E2E(End to End) 테스트

### Static Test

> 코드를 실행시키지 않고 테스트 하는 것

- Type 에러나 Reference 에러와 같은 **개발자의 실수로 인해 발생하는 에러**를 미연에 방지
- 프론트엔드의 경우 `ESLint`를 활용하거나 사용하지 않는 변수를 찾는 것
- TypeScript로 함수의 인자로 받는 파라미터의 타입 검사를 하는 것

### Unit Test

> 각 모듈을 단독 실행 환경에서 독립적으로 테스트 하는 것

- 의존성이 있는 코드와 함께 테스트하는 `Sociable` 테스트
- 모듈에 의해 실행되는 코드를 테스트 더블로 대체하는 `Solitary` 테스트

```
❓ 테스트 더블
   테스트를 위해 사용되는 모의 객체/코드를 말한다.
   테스트를 진행하기 어려운 경우 이를 대신해 테스트를 진행할 수 있도록 만들어주는 객체

   예를 들어, 랜덤으로 생성되어서 그 값을 맞추는 게임이 있다고 할 때,
   랜덤으로 생성되는 값을 테스트 더블을 이용하여 반환되는 랜덤한 값을 결정해줄 수 있다.
   → 정확한 값을 사용해서 특정 상황에 대한 테스트를 특정할 수 있다.
```

<p align="center"><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aj-Z34cBE-mDgzb5116ykg.png"/></p>

```
❓ 프론트엔드에서의 단위 테스트
   프론트엔드에서의 단위 테스트는 특정 컴포넌트를 렌더링해서 깨지지 않는지 확인하는 것을 예로 들 수 있다.

   Sociable 테스트는 자식(child) 컴포넌트까지 포함해서 렌더링하는 것
   Solitary 테스트는 자식 컴포넌트를 모킹해서 렌더링하는 것
   으로 볼 수 있다.
```

### Integration Test

> 두 개 이상의 모듈이 실제로 연결된 상태를 테스트 하는 것

- 모듈 간의 연결에서 발생하는 에러 검증
- 단위 테스트보다 비교적 넓은 범위에서 테스트
- 테스트 더블의 사용 여부에 따라
  - `broad test`: 의존성이 있는 모든 모듈이 연결된 상태를 테스트
  - `narrow test`: 연결된 모듈을 테스트 더블로 대체하여 테스트

```
❓ 프론트엔드에서의 통합 테스트
   프론트엔드에서의 통합 테스트는 UI와 API 간의 상호작용이 올바르게 일어나는지,
   state에 따른 UI의 변경이 올바르게 동작하는지를 확인하는 것

   → 실제 API를 호출하여 broad test를 하거나
     API client를 모킹(mocking)하거나
     가상 API 서버를 이용함으로써 narrow test를 수행할 수 있다.
```

### E2E Test

> 실제 사용자의 입장 및 환경에서 테스트 하는 것

```
❓ 프론트엔드에서의 E2E 테스트
   프론트엔드에서의 E2E 테스트는 실제 브라우저를 실행해서 테스트 하는 것
   커버리지가 높고 실제 상황에서 발생할 수 있는 에러를 검출할 수 있다는 장점

   또, 브라우저를 띄우기 → Web API를 활용 가능 / 실행 속도 느림

   → 실행 환경에서 발생하는 문제들(네트워크 에러 등)로 인해 테스트 실패할 수도
   → E2E 테스트의 결과를 신뢰하기 어려운 단점도 존재
```

## 🖼️ 프론트엔드 관점의 테스트

> 프론트엔드 개발자의 역할을 잘 생각해보면 테스트의 대상을 좀 더 명확하게 구분 가능!

### 테스트 대상

- 시각적 요소
- 사용자 이벤트
- API 통신

**1️⃣ 시각적 요소**

- 프론트엔드 개발자는 디자이너로부터 전달받은 디자인을 보고 HTML로 마크업을 한 뒤 CSS를 입히는 작업을 수행한다.
- 일반적으로 HTML 구조가 의도한 대로 나타나는지를 테스트하기 위해 스냅샷 테스트를 수행
- HTML에 CSS를 더해 컴포넌트가 실제로 브라우저에서 렌더링 되는 모습이 의도한 대로 타나나는지를 테스트하기 위해 시각적 회귀 테스트(Regression Test)를 수행

```
❓ 대표적으로
   스냅샷 테스트 → Jest
   시각적 회귀 테스트 → Storybook
```

```
❓ 스냅샷 테스트(snapshot test)
   어떤 기능의 예상 결과를 미리 정확히 포착해두고 실제 결과에 비교하는 테스트
   → 실제 결과와 예상 결과갇 달라질 경우 실패
```

**2️⃣ 사용자 이벤트 처리**

- 프론트엔드 개발자는 사용자의 마우스, 키보드 등의 **입력 이벤트를 적절한 이벤트 핸들러로 처리**하는 작업도 담당
- 이를 테스트하기 위해 자바스크립트 API 또는 React와 같은 라이브러리에서 제공하는 테스트 유틸리티를 활용하여 시뮬레이션 하거나 E2E 테스트

```
❓ 대표적으로
   React팀이 권장하는 테스트 도구인 testing-library
   → 활용하면 사용자 이벤트를 보다 효율적으로 시뮬레이션 가능
```

**3️⃣ API 서버 통신**

- 프론트엔드 개발자는 브라우저 API 또는 라이브러리를 활용하여 API 서버와 통신하여 애플리케이션 상태를 동기화하는 작업도 수행
- API 서버와의 통신을 테스트하는 방법
  - 실제 API를 활용하는 방법 (주로 E2E 테스트에서 사용)
  - 테스트 API 서버 구축, API client 모킹

```
❓ API client를 모킹하면
  API 요청에 대한 응답을 원하는대로 수정할 수 있기 떄문에
  다양한 상황을 테스트할 수 있다는 장점 존재

  → Jest를 활용하면 모듈을 간단한 방법으로 모킹 가능
  → testing-library와 마찬가지로 Jest를 테스트 도구로 활용할 것을 React팀에서 권장!
```

### 테스트 환경

> 프론트엔드 테스트 환경에는 어떤 것들이 있고 각 환경이 어떻게 다른지 이해하는 것이 필요 !

그 이유는 테스트 환경에 따른 트레이드 오프가 존재하며 테스트 환경 별로 다른 도구들이 사용되기 때문

- 브라우저 환경
- Node.js 환경

**1️⃣ 브라우저 환경**

- Web API에 접근할 수 있다는 장점
- 서로 다른 브라우저에서 테스트 가능 → 브라우저 호환성 및 기기 호환성 테스트도 가능
- 브라우저 프로세스 비용 > Node.js 프로세스 비용

**2️⃣ Node.js 환경**

- 브라우저 환경보다 속도가 빠르다는 장점
- 다만, 브라우저에서 제공하는 Web API, DOM 접근 API를 사용할 수 없다는 단점
- 이러한 문제를 극복하기 위해 `Jest`와 같은 테스트 도구들은 `jsdom`처럼 DOM을 가상으로 구현하는 라이브러리를 활용

### Testing Tools

> 프론트엔드 환경벼롤 활용할 수 있는 도구들에는 어떤 것이 있는지 알아보자

**브라우저 환경**

1️⃣ TestCafe

- 크로스 브라우징, 크로스 플랫폼 환경에서 테스트하는 데에 특화된 E2E 테스트 도구

<p align="center"><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ib-CyMvyaFbnClYIcFpfDQ.png"  width="70%"/></p>

- 프록시 서버 실행, 자동화된 스크립트를 페이지에 주입하고 페이지에 포함된 모든 URL이 프록시를 가리키도록 변경

**Node.js 환경**

1️⃣ Jest

- 페이스북에서 개발한 자바스크립트 테스팅 프레임워크
- 단언(assertion)뿐만 아니라, 모킹, 스냅샷 테스팅, 코드 커버리지 등 다양한 API를 제공

2️⃣ Testing library

- UI를 사용자 관점에서 테스트할 수 있도록 도와주는 라이브러리
- 컴포넌트 내부의 상태가 어떻게 바뀌는지에만 집중

# Reference

- [콴다 기술 블로그 - 모던 프론트엔드 테스트 전략 — 1편(Testing Overview)](https://blog.mathpresso.com/%EB%AA%A8%EB%8D%98-%ED%94%84%EB%A1%A0%ED%8A%B8%EC%97%94%EB%93%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%A0%84%EB%9E%B5-1%ED%8E%B8-841e87a613b2)
- [Tecoble - Test Double을 알아보자](https://tecoble.techcourse.co.kr/post/2020-09-19-what-is-test-double/)
